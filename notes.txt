import pandas as pd
from pmdarima.arima import auto_arima

# Assuming df_2023_clean is your cleaned dataframe containing data for 2023
# Assuming 'Total Incremental Revenue' is the column to forecast
# Assuming 'Close Month', 'BU/COE', and 'Close Year' are the columns representing time periods

# Grouping the data by 'Close Month', 'BU/COE', and 'Close Year' and aggregating the total incremental revenue
grouped_df_2023_clean = df_2023_clean.groupby(['Close Month', 'BU/COE', 'Close Year']).agg({'Total Incremental Revenue': 'sum'}).reset_index()

# Pivot the dataframe to have 'Close Month' as index and 'BU/COE' as columns
pivot_df_2023_clean = grouped_df_2023_clean.pivot(index='Close Month', columns='BU/COE', values='Total Incremental Revenue')

# Forecasting for the next year for each BU/COE using autoARIMA
forecasts = {}
for column in pivot_df_2023_clean.columns:
    time_series = pivot_df_2023_clean[column]
    model = auto_arima(time_series, seasonal=True, m=12)  # Assuming monthly seasonal pattern
    forecast = model.predict(n_periods=12)  # Forecasting for the next 12 months
    forecasts[column] = forecast

# Creating a dataframe to store the forecasts
forecast_df = pd.DataFrame(forecasts, index=pd.date_range(start='2023-01-01', periods=12, freq='M'))

# Print the forecasts for each BU/COE
print(forecast_df)

import os
import pandas as pd
import warnings

# Suppress deprecation warning
warnings.filterwarnings("ignore", message="The behavior of DataFrame concatenation with empty or all-NA entries is deprecated.")

# Function to read CSV files, add a 'week' column, and append to a master DataFrame
def process_folder(folder_path, week, master_dfs):
    for root, dirs, files in os.walk(folder_path):
        for file in files:
            if file.lower() in ["executive_summary_table.csv", "l2c enabled revenue (created pipeline).csv"]:
                continue  # Skip these files
            if file.endswith(".csv"):
                file_path = os.path.join(root, file)
                df = pd.read_csv(file_path)
                df['week'] = week
                if file in master_dfs:
                    master_dfs[file] = pd.concat([master_dfs[file], df], ignore_index=True)
                else:
                    master_dfs[file] = df
    return master_dfs

# Initialize master DataFrames
master_dfs = {}

# Iterate over folders
for i in range(3, 14):
    folder_path = f"C:/Users/mim27/Desktop/Projects/L2C_Append/2. l2c enab/{i}"  # Change the path accordingly
    if os.path.exists(folder_path):
        master_dfs = process_folder(folder_path, i, master_dfs)

# Write master DataFrames to final CSV files
for file, df in master_dfs.items():
    df.to_csv(f"{file}_final.csv", index=False)
